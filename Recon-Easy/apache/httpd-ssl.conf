# Virtual Hosts Configuration

# --- Port 80 Virtual Host ---
# Redirects all HTTP traffic to HTTPS for the default host
<VirtualHost *:80>
    ServerName default.local
    RewriteEngine On
    RewriteRule ^/?(.*) https://%{HTTP_HOST}/$1 [R=301,L]
</VirtualHost>

# --- Port 443 Virtual Hosts (SSL) ---

# Listen on port 443 for SSL connections
Listen 443

# Default SSL Virtual Host (Public "North Torbia" Site)
# This host will be served if the hostname requested doesn't match any other ServerName/ServerAlias
<VirtualHost *:443>
    DocumentRoot "/usr/local/apache2/htdocs/public"
    ServerName public.ctf.local 
    ErrorLog "logs/public-error_log"
    CustomLog "logs/public-access_log" common

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile "/usr/local/apache2/conf/certs/server.crt"
    SSLCertificateKeyFile "/usr/local/apache2/conf/certs/server.key"

    <Directory "/usr/local/apache2/htdocs/public">
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
</VirtualHost>

<VirtualHost *:443>
    DocumentRoot "/usr/local/apache2/htdocs/private"
    ServerName definitelynotaflag.north.torbia

    ErrorLog "logs/private-error_log"
    CustomLog "logs/private-access_log" common

    # SSL Configuration (uses the same certificate as the public site)
    SSLEngine on
    SSLCertificateFile "/usr/local/apache2/conf/certs/server.crt"
    SSLCertificateKeyFile "/usr/local/apache2/conf/certs/server.key"

    <Directory "/usr/local/apache2/htdocs/private">
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
</VirtualHost>
